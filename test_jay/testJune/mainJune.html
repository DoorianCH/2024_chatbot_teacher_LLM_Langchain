<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <h1>상담</h1>
</head>
<body>
    <div>
        <strong>방법:</strong>
        <select id="method" name="method">
            <option class="methodOption" name="method" type="radio" value="visit">방문</option>
            <option class="methodOption" name="method" type="radio" value="tell">전화</option>
            <option class="methodOption" name="method" type="radio" value="ex">기타</option>                  
        </select>
    </div>

    <div>
        <strong>상담자:</strong>
        <label>학생</label><input class="client" name="client" type="radio" value="student" checked>
        <label>학부모</label><input class="client" name="client" type="radio" value="parent">
    </div> 
   
    <div>
        <strong>유형:</strong>
        <select id="category" name="category" onchange="toggleOtherInput()">
            <option value="life">학교생활</option>
            <option value="friendship">교우관계</option>
            <option value="learning">학습</option>
            <option value="other">기타</option>
        </select>
        <span id="otherInput">
            <input type="text" id="otherText" placeholder="기타 입력" readonly>
        </span>
    </div>
    
    <div>
        <strong>장소:</strong><input class="location" id="location" type="text" placeholder="학교">
        <strong>날짜:</strong><input class="date" id="date" type="date">     
    </div>
   
    <div>
        <strong>상담내용:</strong><input id="contents" type="text">
    </div> 
    
    <button onclick="saveConsultationData()">저장</button>
    
    <script>
        function toggleOtherInput() {
            const category = document.getElementById('category').value;
            const otherInput = document.getElementById('otherText');
            if (category === "other") {
                otherInput.readOnly = false;
            } else {
                otherInput.readOnly = true; 
                otherInput.value = ''; 
            }
        }

        function getClientValue() {
            const options = document.getElementsByName('client');
            for (let i = 0; i < options.length; i++) {
                if (options[i].checked) {
                    return options[i].value;
                }
            }
        }

        function getCategoryValue() {
            const category = document.getElementById('category').value;
            const otherInput = document.getElementById('otherText').value;
            return category === 'other' ? otherInput : category;
        }

        function validateInputs(date, contents) {
            if (!date) {
                alert("상담 날짜를 입력해주세요");
                return false;
            }
            if (!contents) {
                alert("상담 내용을 입력해주세요");
                return false;
            }
            return true;
        }

        function createJsonData() {
            const studentName = "최준원";
            const studentNum = "010-4599-3761";
            const studentParentNum = "010-4741-3761";

            const method = document.getElementById("method").value;
            const client = getClientValue();
            const category = getCategoryValue();
            const date = document.getElementById("date").value;
            const location = document.getElementById("location").value || "학교";
            const contents = document.getElementById("contents").value;

            if (!validateInputs(date, contents)) {
                return null;
            }

            const jsonData = {
                studentName: studentName,
                studentNum: studentNum,
                studentParentNum: studentParentNum,
                [date]: { 
                    method: method,
                    client: client,
                    location: location,
                    contents: contents
                }
            };

            return JSON.stringify(jsonData, null, 2);
        }

        function downloadJson(jsonString, filename) {
            const blob = new Blob([jsonString], { type: "application/json" });
            const url = URL.createObjectURL(blob);
            const a = document.createElement("a");
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function saveConsultationData() {
            const jsonData = createJsonData();
            if (jsonData) {
                downloadJson(jsonData, "data/1.json");
                alert("상담 데이터가 저장되었습니다.");
            }
        }
    </script>
</body>
</html>
